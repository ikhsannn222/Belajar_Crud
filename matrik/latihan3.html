<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>Sistem Evaluasi Nilai Kelas</title>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
      body {
        font-family: Arial, sans-serif;
      }
      input {
        margin: 3px;
      }
      table {
        border-collapse: collapse;
        width: 80%;
        margin-top: 20px;
      }
      th,
      td {
        border: 1px solid #000;
        padding: 8px;
        text-align: center;
      }
      th {
        background-color: #f2f2f2;
      }
    </style>
  </head>
  <body>
    <h3>Input Nilai Mahasiswa</h3>

    <input type="text" id="nama" placeholder="Nama Mahasiswa" />
    <input type="number" id="n1" placeholder="Nilai 1" />
    <input type="number" id="n2" placeholder="Nilai 2" />
    <input type="number" id="n3" placeholder="Nilai 3" />
    <br />

    <button onclick="tambahMahasiswa()">Tambah Data</button>

    <h4>Pencarian Mahasiswa</h4>
    <input type="text" id="cariNama" placeholder="Nama Mahasiswa" />
    <button onclick="cariMahasiswa()">Cari</button>

    <p id="rataKelas"></p>
    <p id="top3"></p>

    <table>
      <thead>
        <tr>
          <th>Ranking</th>
          <th>Nama</th>
          <th>Rata-rata</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="tabelHasil"></tbody>
    </table>

    <script>
      let data = [];

      function tambahMahasiswa() {
        let nama = document.getElementById("nama").value;
        let n1 = parseFloat(document.getElementById("n1").value);
        let n2 = parseFloat(document.getElementById("n2").value);
        let n3 = parseFloat(document.getElementById("n3").value);

        if (nama === "" || isNaN(n1) || isNaN(n2) || isNaN(n3)) {
          Swal.fire("Gagal", "Semua data harus diisi!", "error");
          return;
        }

        if (n1 < 0 || n1 > 100 || n2 < 0 || n2 > 100 || n3 < 0 || n3 > 100) {
          Swal.fire("Error", "Nilai harus antara 0 - 100", "error");
          return;
        }

        let rata = (n1 + n2 + n3) / 3;
        let status = rata >= 70 ? "LULUS" : "TIDAK LULUS";

        data.push([nama, n1, n2, n3, rata, status]);

        prosesSemua();

        document.getElementById("nama").value = "";
        document.getElementById("n1").value = "";
        document.getElementById("n2").value = "";
        document.getElementById("n3").value = "";

        Swal.fire("Berhasil", "Data mahasiswa ditambahkan", "success");
      }

      function prosesSemua() {
        // Urutkan berdasarkan rata-rata (descending)
        data.sort((a, b) => b[4] - a[4]);

        tampilkanData();
        tampilkanTop3();
        hitungRataKelas();
      }

      function tampilkanData() {
        let tbody = document.getElementById("tabelHasil");
        tbody.innerHTML = "";

        for (let i = 0; i < data.length; i++) {
          tbody.innerHTML += `
        <tr>
          <td>${i + 1}</td>
          <td>${data[i][0]}</td>
          <td>${data[i][4].toFixed(2)}</td>
          <td>${data[i][5]}</td>
        </tr>
      `;
        }
      }

      function tampilkanTop3() {
        let teks = "Top 3 Mahasiswa: ";
        let batas = Math.min(3, data.length);

        for (let i = 0; i < batas; i++) {
          teks += `${data[i][0]} (${data[i][4].toFixed(2)}) `;
          if (i < batas - 1) teks += "| ";
        }

        document.getElementById("top3").innerText = teks;
      }

      function hitungRataKelas() {
        let total = 0;

        for (let i = 0; i < data.length; i++) {
          total += data[i][4];
        }

        let rataKelas = total / data.length;

        document.getElementById("rataKelas").innerText =
          "Rata-rata Nilai Kelas: " + rataKelas.toFixed(2);
      }

      function cariMahasiswa() {
        let namaCari = document.getElementById("cariNama").value.toLowerCase();
        let ketemu = false;

        for (let i = 0; i < data.length; i++) {
          if (data[i][0].toLowerCase() === namaCari) {
            Swal.fire(
              "Mahasiswa Ditemukan",
              `Rata-rata: ${data[i][4].toFixed(2)} | Status: ${data[i][5]}`,
              "success"
            );
            ketemu = true;
            break;
          }
        }

        if (!ketemu) {
          Swal.fire("Tidak Ditemukan", "Mahasiswa tidak ada", "error");
        }
      }
    </script>
  </body>
</html>
